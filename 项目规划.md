# MyGame 项目规划文档

## 项目概述

**MyGame** 是一个基于SDL3开发的2D射击生存游戏，采用模块化设计，支持复杂的物品系统、状态管理和网络架构。项目使用C++17开发，采用面向对象和组件化设计模式。

### 核心特性
-  实时2D射击游戏
-  复杂的物品和装备系统
-  智能AI生物系统
-  无限生成的地图系统
-  完整的音效管理
-  网络多人游戏架构
-  现代化UI界面

## 整体架构设计

### 1. 核心系统架构

```
Game (单例)
├── 实体系统 (Entity)
│   ├── Player (玩家)
│   ├── Creature (生物基类)
│   └── Zombie (丧尸)
├── 物品系统 (Item)
│   ├── Gun (武器)
│   ├── Magazine (弹匣)
│   ├── Ammo (弹药)
│   └── Storage (存储)
├── 地图系统 (Map)
│   ├── Grid (网格)
│   └── Tile (地形)
├── UI系统 (GameUI)
│   ├── HUD (游戏内界面)
│   └── UIWindow (窗口系统)
└── 网络系统 (PlayerController)
    ├── 本地控制器
    └── 远程控制器
```

### 2. 设计模式应用

| 设计模式 | 应用场景 | 实现类 |
|---------|---------|--------|
| **单例模式** | 游戏核心管理 | `Game`, `SoundManager`, `ItemLoader` |
| **工厂模式** | 物品创建 | `ItemLoader` |
| **状态模式** | 实体状态管理 | `EntityStateManager` |
| **观察者模式** | 状态变化回调 | `EntityStateManager` |
| **命令模式** | 行为系统 | `ActionQueue`, `Action` |
| **MVC模式** | 网络架构 | `Player`(Model), `PlayerController`(Controller) |

### 3. 内存管理策略

- **智能指针**: 使用 `unique_ptr` 和 `shared_ptr` 进行自动内存管理
- **RAII原则**: 确保资源正确释放
- **对象池**: 子弹等频繁创建的对象使用对象池模式
- **分帧加载**: 地图网格异步加载，避免卡顿

### 4. 核心游戏设计理念

#### 武器系统设计
- **手持武器机制**: 所有武器只有在手持时才发挥武器作用，没有装备槽的概念
- **真实性导向**: 玩家需要主动选择和切换武器，增加游戏的策略性和真实感
- **装备位置说明**: 手部装备位置专为手套等防护装备设计，不用于武器装备

## 代码要求与规范

### 命名规范
- 类命名：使用PascalCase（如PlayerController）
- 方法命名：使用camelCase（如updatePlayerUI）
- 变量命名：使用描述性名称（如cameraX, cameraY）
- 常量命名：使用UPPER_SNAKE_CASE（如MIN_ZOOM）

### 设计原则
- 继承体系：所有实体类继承Entity基类，所有物品类继承Item基类。Entity有两类分支，一个是Player类用于实现玩家角色，一个是Creature类用于实现多种怪物
- 内存管理：使用智能指针和RAII原则
- 模块化：采用组件化和插件式设计
- 高通用性拓展性：因为会涉及大量不同的物品和生物，需要保存到json中并且提取关键通用方法来快速实现、加载
- 错误处理：完善的异常处理和返回值检查
- 低耦合：相关内容尽可能不耦合，以此支持联机模式
- 高维护性：相似的游戏内容在一处定义并且多处调取，以此实现快速、准确地功能拓展

## 任务列表

### 已完成功能

#### 核心系统
- [x] 游戏主循环 - Game类实现完整的游戏循环
- [x] SDL3集成 - 视频、音频、字体系统初始化
- [x] 实体系统 - Entity基类及基础功能
- [x] 物理系统 - 简化的碰撞检测和分离算法
- [x] 相机系统 - 跟随玩家，支持缩放

#### 玩家系统
- [x] 玩家控制 - 键盘鼠标输入处理
- [x] 玩家状态 - 生命值、装备、存储管理
- [x] 射击系统 - 武器射击、子弹物理
- [x] 物品交互 - 拾取、装备、存储物品

#### 物品系统
- [x] 物品基类 - Item类及标签系统
- [x] 武器系统 - Gun类及配件系统
- [x] 弹药系统 - Ammo、Magazine类
- [x] 存储系统 - Storage类及容量管理
- [x] 装备系统 - EquipmentSystem类
- [x] 物品加载器 - ItemLoader JSON配置解析

#### 地图系统
- [x] 无限地图 - 基于哈希表的网格系统
- [x] 地形生成 - 程序化地图生成
- [x] 视距裁剪 - 性能优化的渲染
- [x] 寻路系统 - A*算法实现

#### 生物
- [x] 生物基类 - Creature类及状态机
- [x] 生物交互 - 受击、掉落物、尸体解剖 
- [x] 丧尸AI - Zombie类及行为模式
- [x] 感知系统 - 视觉、听觉、嗅觉范围
- [x] 攻击系统 - CreatureAttack类

#### UI系统
- [x] 游戏UI - GameUI类及窗口管理
- [x] HUD界面 - 生命值、弹药显示
- [x] 物品提示 - 悬停显示物品信息
- [x] 拖拽系统 - 物品拖拽操作

#### 状态系统
- [x] 状态管理器 - EntityStateManager类
- [x] 状态效果 - EntityStateEffect类
- [x] 行为队列 - ActionQueue类
- [x] 动作系统 - Action类及子类

#### 音效系统
- [x] 音效管理 - SoundManager单例
- [x] 音效播放 - 射击、移动、UI音效
- [x] 音量控制 - 音效音量调节

### 进行中功能

#### 重构工作
- [ ] Monster→Creature - 生物系统重构
- [ ] 状态系统升级 - 新状态效果系统
- [ ] 物理系统简化 - 移除复杂物理计算

### 待实现功能

#### 游戏内容
- [ ] 任务系统 - 主线任务、支线任务
- [ ] 成就系统 - 玩家成就解锁
- [ ] 技能系统 - 玩家技能等级提升
- [ ] 商店系统 - NPC商店、物品购买
- [ ] 对话系统 - NPC对话、剧情推进
- [ ] 事件系统 - 随机事件触发

#### 生物系统
- [ ] 更多生物类型 - 动物、机器人、异界生物
- [ ] 群体行为 - 生物群体AI、协作攻击
- [ ] 进化系统 - 生物适应性进化（尤其是丧尸生物）
- [ ] 生物习性 - 昼夜活动、觅食行为、迁移行为
- [ ] 首领生物 - 特殊精英怪物

#### 物品系统
- [ ] 近战武器 - 刀剑、棍棒、矛类
- [ ] 投掷武器 - 手雷、飞刀、投矛
- [ ] 防具系统 - 护甲、头盔、靴子
- [ ] 消耗品 - 药品、食物、工具
- [ ] 工具等级 - 不同工具有不同的功能等级
- [ ] 装备强化 - 武器升级、改装
- [ ] 制作系统 - 物品制作、材料合成
- [ ] 耐久度系统 - 装备磨损、维修
- [ ] 穿戴系统 - 装备覆盖率、防护等级

#### 地图系统
- [ ] 多样地形 - 水域、沼泽、山地、沙漠
- [ ] 建筑系统 - 房屋、废墟、地下室
- [ ] 天气系统 - 雨雪、雾霾、风暴
- [ ] 昼夜系统 - 光照变化、温度影响
- [ ] 季节系统 - 四季轮换
- [ ] 地标系统 - 特殊地点、宝藏
- [ ] 动态地形 - 地形破坏、重建
- [ ] 传送系统 - 快速旅行

#### 多人游戏
- [ ] 服务器架构 - 权威服务器实现
- [ ] 房间系统 - 创建、加入游戏房间
- [ ] 好友系统 - 添加、管理好友
- [ ] 观战系统 - 观看其他玩家游戏

#### 生存要素
- [ ] 饥饿系统 - 饥饿值、热量需求
- [ ] 口渴系统 - 水分需求
- [ ] 疲劳系统 - 体力消耗、睡眠要求
- [ ] 疾病系统 - 生病、恢复
- [ ] 温度系统 - 体温调节与保暖衣物
- [ ] 辐射系统 - 辐射伤害、防护
- [ ] 中毒系统 - 毒素积累、解毒
- [ ] 精神状态 - 心情、压力值

#### 建造系统
- [ ] 基地建设 - 以方格为单位建造
- [ ] 防御工事 - 围墙、陷阱
- [ ] 资源采集 - 挖掘、砍伐、收集
- [ ] 工作台 - 制作台、研究台
- [ ] 储存设施 - 仓库、保险箱
- [ ] 发电系统 - 电力生产、分配
- [ ] 农业系统 - 种植、养殖

#### 技术优化
- [ ] 性能优化 - 渲染优化、内存优化
- [ ] 多线程 - 异步加载、并行计算
- [ ] 调试工具 - 游戏内调试界面

#### 平台支持
- [ ] 跨平台 - Linux、macOS支持
- [ ] 移动端 - Android、iOS版本
- [ ] 云存档 - 云端存档同步
- [ ] Steam集成 - 成就、云存档、创意工坊
- [ ] 控制器支持 - 手柄、摇杆支持
- [ ] VR支持 - 虚拟现实版本
- [ ] 流媒体 - 游戏直播、录制
- [ ] 模组支持 - 用户自定义内容

#### 网络系统(暂时搁置)
- [ ] 网络架构 - PlayerController抽象层
- [ ] 远程玩家 - RemotePlayerController实现
- [ ] 状态同步 - 玩家状态网络传输
- [ ] 网络通信 - 底层网络协议实现

## 开发优先级

### 高优先级 (P0)
1. UI交互实现 
2. 操作完善 
3. 物品功能重构 
4. 方块的实现与加载
5. 其它底层功能实现 

### 中优先级 (P1)
1. 存档功能
2. 生存要素 - 饥饿、口渴、疲劳系统
3. 更多生物类型 - 丰富游戏世界
4. 装备强化系统 - 增加游戏深度
5. 天气系统 - 增强沉浸感

### 低优先级 (P2)
1. 任务系统 - 增加游戏内容
2. 建造系统 - 方格建设功能

## 技术债务

### 需要重构的代码
1. Monster类 - 完全替换为Creature系统
2. 旧状态系统 - 移除EntityState枚举
3. 硬编码配置 - 迁移到JSON配置文件
4. 魔法数字 - 替换为命名常量

### 性能问题
1. 内存泄漏 - 检查智能指针使用
2. 渲染效率 - 优化渲染管线
3. 碰撞检测 - 优化碰撞算法

### 代码质量
1. 错误处理 - 完善异常处理
2. 代码审查 - 定期代码审查

## 里程碑计划

### 里程碑1: 基础功能完善 (当前)
- [x] 核心游戏循环
- [x] 玩家控制系统
- [x] 物品系统
- [x] 基础AI系统
- [x] 装备系统
- [x] 方块功能与加载
- [x] 地图生成与加载

### 里程碑2: 内容丰富化 (计划中)
- [ ] 任务系统实现
- [ ] 生存要素系统
- [ ] 更多生物类型
- [ ] 装备强化系统
- [ ] 天气系统

### 里程碑3: 网络多人游戏 (进行中)
- [ ] 网络架构实现
- [ ] 玩家状态同步
- [ ] 多人游戏测试
- [ ] 网络性能优化

### 里程碑4: 商业发布 (长期)
- [ ] Steam平台集成
- [ ] 跨平台支持
- [ ] 云存档系统
- [ ] 社区功能

## 总结

MyGame项目已经建立了坚实的基础架构，具备了现代游戏开发的核心要素。通过模块化设计和良好的代码组织，项目具有良好的可扩展性和维护性。

当前重点是完善网络系统，实现真正的多人游戏功能，同时继续优化AI系统和游戏内容。项目的长期目标是成为一个功能完整、性能优秀的商业级游戏。

---

*本文档将随着项目发展持续更新，请定期查看最新版本。* 